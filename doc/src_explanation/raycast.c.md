# `src/engine/raycast.c` 詳細解説

## 概要
レイキャスティング・レンダリングエンジンの核心部分です。レイの生成、壁との衝突判定、テクスチャ座標計算、そして垂直線の描画を行います。

## コード詳細解説

| 行番号 | コード | 解説 |
| :--- | :--- | :--- |
| **16** | `void init_ray(t_game *game, int x)` | **レイ初期化**<br>画面上のX座標(`x`)に対応するレイの方向ベクトルと、DDA用パラメータ(`delta_dist`等)を計算します。 |
| **19** | `  camera_x = 2 * x ...` | 画面X座標をカメラ平面上の座標(-1 ～ 1)に正規化します。 |
| **20-21** | `  game->ray.ray_dir_x = ...` | プレイヤーの方向ベクトルとカメラ平面ベクトルを合成し、このレイの方向を決定します。 |
| **24-25** | `  game->ray.delta_dist_x = ...` | **Delta Distance**<br>レイがX(またはY)方向に1グリッド進むために必要な距離です。`fabs(1/ray_dir)`で計算されます。 |
| **31** | `static double get_wall_x(t_game *game)` | **壁面衝突位置**<br>壁の「どこに」当たったか（0.0-1.0）を計算します。テクスチャのX座標決定に使用されます。 |
| **35-37** | `    wall_x = ...` | プレイヤー位置 + 距離 * レイ方向 で正確な衝突点を求めます。 |
| **42** | `static int get_tex_x(...)` | **テクスチャX座標**<br>`wall_x`をテクスチャ幅に合わせた整数値(0-63等)に変換します。 |
| **46-48** | `  if (...) tex_x = ...` | **反転処理**<br>壁の裏側（南・西）を見る場合、テクスチャが反転しないように座標を反転させます。 |
| **52** | `static void calc_wall_and_tex(...)` | **描画計算**<br>壁の高さ、描画開始・終了Y座標を決定します。 |
| **55-61** | `    perp_wall_dist = ...` | **垂直距離**<br>魚眼効果を防ぐため、ユークリッド距離ではなくカメラ平面への投影距離を使用します。 |
| **62** | `  game->ray.line_height = ...` | 距離に反比例して壁の高さを決定します。 |
| **69** | `  select_texture(game, tex);` | 当たった壁の種類（東西南北・ドア）に応じてテクスチャを選択します。 |
| **73** | `void raycast(t_game *game)` | **レイキャストループ**<br>画面幅分ループし、各列の描画処理を行います。 |
| **82** | `    perform_dda(game);` | レイを壁に当たるまで飛ばします。 |
| **84** | `    game->z_buffer[x] = ...` | スプライト描画のために深度情報を保存します。 |
| **85-86** | `    draw_floor_ceiling... draw_textured_line...` | 天井・床・壁を順に描画します。 |
