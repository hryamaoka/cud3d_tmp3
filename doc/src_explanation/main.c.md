# `src/main.c` 詳細解説

## 概要
プログラムのエントリーポイントです。コマンドライン引数の検証、ゲーム構造体の初期化、マップファイルのパース、ウィンドウの作成、そしてメインループの開始という一連の流れを制御します。

## 依存関係
*   `cub3d.h`: メイン構造体 `t_game` や主要関数の定義。

## 関数詳細: main

### プロトタイプ
`int main(int argc, char *argv[])`

### 戻り値
*   正常終了時は関数内の無限ループへ移行し、明示的なreturnには到達しません（OSへ制御が戻るのは `exit()` 時）。
*   エラー時は `perror_and_exit` により `1` で終了します。

### コード行別解説

| 行番号 | コード | 詳細解説 |
| :--- | :--- | :--- |
| 15 | `int main(int argc, char *argv[])` | **メイン関数**<br>標準的なC言語のエントリーポイント。`argc` は引数の数、`argv` は引数の文字列配列です。 |
| 16 | `t_game game;` | **ゲーム構造体宣言**<br>スタック上に `game` 変数を確保します。これがプログラム全体の状態を保持します。 |
| 18 | `if (argc != 2)` | **引数チェック**<br>引数がちょうど2つ（プログラム名 + マップファイルパス）であることを確認します。 |
| 19 | `perror_and_exit("usage: ...", NULL);` | 引数が正しくない場合、使い方を表示して終了します。 |
| 20 | `if (!check_filename(argv[1]))` | **ファイル名検証**<br>マップファイルの拡張子が `.cub` であるかを確認します（`src/parser/check_file.c` で定義）。 |
| 21 | `perror_and_exit("usage: ...", NULL);` | 拡張子が不正な場合、エラー終了します。 |
| 22 | `init_game(&game);` | **構造体初期化**<br>`game` 構造体のメンバ変数を安全な初期値（NULLや-1など）に設定します（`src/core/game_init.c`）。 |
| 23 | `parse(argv[1], &game);` | **マップ解析**<br>指定されたファイルを読み込み、テクスチャ、色、マップ情報を `game` 構造体に格納します（`src/parser/parse_main.c`）。 |
| 24 | `if (!init_window(&game))` | **ウィンドウ作成**<br>MLXを初期化し、ウィンドウを作成します（`src/core/window.c`）。 |
| 25 | `perror_and_exit("Could not initialize ...", &game);` | ウィンドウ作成失敗時はリソースを解放して終了します。 |
| 26 | `if (!init_textures(&game))` | **テクスチャロード**<br>XPMファイルを読み込み、画像データとしてメモリに展開します（`src/parser/textures_init.c`）。 |
| 27 | `perror_and_exit("Could not load ...", &game);` | テクスチャ読み込み失敗時エラー。 |
| 28 | `init_sprites(&game);` | **スプライト初期化**<br>マップ上のスプライト（アイテム等）の位置を検出し、専用のリストに登録します。元のマップ上の記号は「床」に置き換えます。 |
| 29 | `mlx_loop(game.mlx);` | **メインループ開始**<br>MLXのイベントループを開始します。これ以降、キー入力や描画更新のイベント待ち状態になります。プログラムはここで待機し続けます。 |
| 30 | `}` | 関数の終わり。 |
