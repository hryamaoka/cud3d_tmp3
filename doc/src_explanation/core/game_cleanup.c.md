# `src/core/game_cleanup.c` 詳細解説

## 概要
ゲーム終了時やエラー発生時に、プログラムが確保した全てのメモリリソース（ヒープメモリ）やMiniLibXのリソース（画像、ウィンドウ、ディスプレイ接続）を適切に解放・破棄するための関数群を提供します。

## 依存関係
*   `cub3d.h`: `t_game` 構造体、`t_img` 構造体の定義。
*   `stdlib.h`: `free` 関数。
*   `mlx.h`: `mlx_destroy_image`, `mlx_destroy_window` 等。

## 関数詳細

### 1. `free_split`
#### プロトタイプ
`void free_split(char **split)`

#### 戻り値
なし

#### 解説
`ft_split` などで生成された、NULL終端の文字列配列（ダブルポインタ）を解放します。各行の文字列を `free` した後に、配列自体のポインタも `free` します。

---

### 2. `free_all`
#### プロトタイプ
`void free_all(t_game *game)`

#### 戻り値
なし

#### 解説
`t_game` 構造体に紐づくすべての動的リソースをクリーンアップします。パースされた文字列、マップ配列、テクスチャ画像、MLXウィンドウなどを順次チェックし、存在する場合のみ解放します。

### コード行別解説 (`free_all`)

| 行番号 | コード | 詳細解説 |
| :--- | :--- | :--- |
| 27-34 | `if (game->tex.no) free(...)` 等 | **テクスチャパス解放**<br>NO, SO, WE, EA のファイルパス文字列を解放します。`NULL` チェックを行うことで、確保前の段階で呼ばれてもクラッシュしないようにしています。 |
| 35-36 | `if (game->map.grid) free_split(...)` | **マップ配列解放**<br>読み込んだマップの文字列配列を `free_split` で解放します。 |
| 37-38 | `if (game->z_buffer) free(...)` | **Zバッファ解放**<br>ウィンドウサイズに合わせて確保された深度バッファ配列を解放します。 |
| 39-40 | `if (game->sprites) free(...)` | **スプライト配列解放**<br>スプライト情報の配列を解放します。 |
| 41 | `if (game->mlx)` | **MLXリソース解放**<br>MLXポインタが初期化されている場合のみ実行します。 |
| 42-47 | `while (i < 4) ... mlx_destroy_image` | **壁テクスチャ破棄**<br>東西南北4枚の壁テクスチャ画像を破棄します。 |
| 48-49 | `if (game->door_tex.img) ...` | **ドアテクスチャ破棄**<br>ドア用画像の破棄。 |
| 50-53 | `if (game->sprite_tex[x].img) ...` | **スプライトテクスチャ破棄**<br>スプライト用画像の破棄。 |
| 55-56 | `if (game->img.img) ...` | **メイン描画バッファ破棄**<br>画面描画用のメイン画像バッファを破棄します。 |
| 57-58 | `if (game->win) mlx_destroy_window` | **ウィンドウ破棄**<br>ウィンドウを閉じます。 |
| 60 | `mlx_destroy_display(game->mlx);` | **ディスプレイ切断**<br>Xサーバーとの接続を切断します（Linux環境で重要）。 |
| 61 | `free(game->mlx);` | **MLXポインタ解放**<br>最後にMLX構造体自体のメモリを解放します。 |
