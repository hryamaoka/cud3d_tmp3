# `src/render/render.c` 詳細解説

## 概要
フレームごとの描画処理を統括します。天井と床の塗りつぶし、計算された情報に基づくテクスチャ付きの壁描画、そして最終的な画像のウィンドウへの転送を行います。

## 依存関係
*   `render.h`: 描画関連関数定義。
*   `mlx.h`: `mlx_put_image_to_window`。

## 関数詳細

### 1. `draw_floor_ceiling`
#### プロトタイプ
`void draw_floor_ceiling(...)`

#### 戻り値
なし

#### 解説
画面の特定列 `x` において、壁の上側（`0` 〜 `draw_start`）を天井色で、壁の下側（`draw_end` 〜 `height`）を床色で塗りつぶします。
これにより、壁以外の背景部分が描画されます。

### 2. `draw_textured_line`
#### プロトタイプ
`void draw_textured_line(t_game *game, int x, int *draw, t_img *tex, int tex_x)`

#### 戻り値
なし

#### 解説
計算された壁の範囲（`draw[0]` 〜 `draw[1]`）に、指定されたテクスチャ `tex` の列 `tex_x` を貼り付けます。
*   `step`: 画面上の1ピクセルあたり、テクスチャ座標をどれだけ進めるか。
*   `tex_pos`: 現在のテクスチャY座標（浮動小数点）。

### 3. `render_frame`
#### プロトタイプ
`int render_frame(t_game *game)`

#### 戻り値
常に `0`。

#### 解説
`mlx_loop_hook` に登録されるメイン描画関数です。毎フレーム呼び出されます。
1.  `raycast`: 壁の位置計算と描画バッファへの書き込み（背景＋壁）。
2.  `draw_sprites`: スプライトの計算と上書き描画。
3.  `draw_minimap`: ミニマップの上書き描画。
4.  `mlx_put_image_to_window`: 完成した画像をウィンドウに転送して表示更新。

### コード行別解説 (`draw_textured_line`)

| 行番号 | コード | 詳細解説 |
| :--- | :--- | :--- |
| 55 | `step = 1.0 * tex->height / ...` | **ステップ計算**<br>テクスチャの高さを壁の描画高さで割ることで、スケーリング比率を求めます。 |
| 56 | `tex_pos = ...` | **初期位置**<br>描画開始点に対応するテクスチャ上のY座標を計算します。壁が画面からはみ出している場合も考慮されています。 |
| 58 | `while (y < draw[1])` | **描画ループ**<br>画面上の指定範囲をピクセルごとに塗ります。 |
| 59 | `tex_y = (int)tex_pos & (tex->height - 1);` | **Y座標取得**<br>現在の位置を整数化します。`& (height - 1)` は `% height` の高速化（ただし高さが2の累乗である必要があります）として機能し、座標のループやオーバーフローを防ぎます。 |
| 63-67 | `game->img.addr[idx] = ...` | **ピクセル書込**<br>テクスチャから取得した色を、画面バッファの対応する位置に書き込みます。 |
