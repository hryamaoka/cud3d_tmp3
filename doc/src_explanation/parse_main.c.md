# `src/parser/parse_main.c` 詳細解説

## 概要
`.cub`設定ファイルのパース処理全体を統括します。ファイルを行単位で読み込み、識別子（NO, SO, C, Fなど）に基づいて適切なパース関数にディスパッチします。また、マップデータの読み込みと整合性チェックの呼び出しも行います。

## コード詳細解説

| 行番号 | コード | 解説 |
| :--- | :--- | :--- |
| **15** | `int process_elem_line(...)` | **要素行処理**<br>各行の内容を解析し、テクスチャや色設定として処理します。 |
| **16** | `  if (is_empty_line(line))` | **空行スキップ**<br>設定部分の空行は無視して処理成功(`1`)とします。 |
| **20-28** | `  { int i = 0; ... if (line[i] == '#') ... }` | **コメントスキップ**<br>行頭（空白飛ばし後）が`#`または`//`の場合、コメント行として無視します。 |
| **29** | `  if (parse_texture(line, game))` | **テクスチャ行判定**<br>テクスチャパース関数を呼び出し、成功すれば要素カウントを加算します。 |
| **31** | `  else if (parse_color(line, game))` | **色設定行判定**<br>色パース関数を呼び出します。 |
| **34** | `    return (0);` | どの要素としても認識できない行はエラー(`0`)を返します。 |
| **39** | `char *parse_elem(int fd, t_game *game)` | **要素読み込みループ**<br>マップ定義が始まるまでの設定行を読み込みます。 |
| **45** | `    line = get_next_line(fd);` | GNLで行読み込み。 |
| **48** | `    if (!process_elem_line(...))` | 要素行処理に失敗した場合（＝マップ行である可能性が高い）。 |
| **49** | `      if (elem_count < 6)` | **必須要素チェック**<br>マップ行到達前に、必須6要素（4テクスチャ+2色）が揃っていない場合は「不明な識別子」エラーとして終了します。 |
| **53** | `      return (line);` | マップの開始行として、読み込んだ行を返します。 |
| **61** | `void parse(char *filename, t_game *game)` | **パースメイン関数**<br>ファイルオープから検証までの一連の流れを実行します。 |
| **65** | `  fd = open(filename, O_RDONLY);` | ファイルオープン。 |
| **70** | `  first_line = parse_elem(fd, game);` | 要素パースを実行し、マップ開始行を取得。 |
| **71** | `  if (!parse_map(fd, game, first_line))` | マップデータをパース。 |
| **73-78** | `  if (!check_map_chars(game)) ...` | **マップ検証**<br>使用可能文字、壁の閉鎖性、プレイヤー存在チェックを順次実行し、不備があれば詳細エラーを出力して終了します。 |
