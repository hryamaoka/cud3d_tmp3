# `src/parser/parse_colors.c` 詳細解説

## 概要
床（Floor）と天井（Ceiling）の色指定行（例: `F 220,100,0`）を解析し、RGB値を構造体に保存します。数値の範囲（0-255）やフォーマット（カンマ区切り）の厳密なチェックを行います。

## 依存関係
*   `parse.h`: パース用ヘッダ。
*   `libft.h`: `ft_split`, `ft_isdigit`, `ft_atoi` 等。

## 関数詳細

### 1. `check_digits`, `validate_commas`
文字列が数値のみで構成されているか、カンマが正しく2つ含まれているか等の低レベルな検証を行います。

### 2. `set_rgb`
#### プロトタイプ
`static int set_rgb(t_color *color, char **param)`

#### 戻り値
*   `1`: 正常設定。
*   `0`: 値が不正（数値でない、範囲外）。

#### 解説
文字列配列を整数に変換し、 `0 <= x <= 255` の範囲内であるかを確認して構造体にセットします。

### 3. `parse_rgb_line`
#### プロトタイプ
`static int parse_rgb_line(char *line, t_color *color)`

#### 戻り値
*   `1`: 成功。
*   `0`: 失敗（重複、フォーマット不正）。

#### 解説
色指定部分の文字列（例: `220,100,0`）を受け取り、カンマで分割して各成分を `set_rgb` で解析します。末尾の改行削除やカンマ数の事前チェックもここで行います。

### 4. `parse_color`
#### プロトタイプ
`int parse_color(char *line, t_game *game)`

#### 戻り値
*   `1`: 色設定行として処理された。
*   `0`: 色設定行ではない。

#### 解説
行を解析し、識別子 `F` または `C` であれば色設定として処理を進めます。

### コード行別解説 (`set_rgb`)

| 行番号 | コード | 詳細解説 |
| :--- | :--- | :--- |
| 31 | `static int set_rgb(t_color *color, char **param)` | **RGB値設定関数**<br>`param` はカンマで分割された3つの数値文字列です。 |
| 34-36 | `if (!check_digits(param[0]) ...)` | 各成分が数字のみで構成されているか確認します（マイナス符号などは `check_digits` 内で弾かれます）。 |
| 37-39 | `color->r = ft_atoi(param[0]);` | **整数変換**<br>文字列を `int` 型に変換して一時的に代入します。 |
| 40-41 | `if (color->r < 0 || color->r > 255 ...)` | **範囲チェック**<br>RGB値の定義通り、0以上255以下であることを確認します。これを超えると色は正しく表現できません。 |
| 43 | `return (1);` | 全てのチェックを通過したら成功を返します。 |

### コード行別解説 (`parse_rgb_line`)

| 行番号 | コード | 詳細解説 |
| :--- | :--- | :--- |
| 68-69 | `if (color->r != -1) return (0);` | **重複チェック**<br>既に初期値 `-1` 以外が入っている場合は、重複定義とみなしてエラーにします。 |
| 76 | `if (!validate_commas(line))` | **カンマ数チェック**<br>カンマが正確に2つあるか確認します。`ft_split` は空フィールドを詰めてしまうことがあるため（例: `,,`）、事前の文字カウントが必須です。 |
| 78 | `param = ft_split(line, ',');` | カンマ区切りで成分に分割します。 |
| 82 | `if (i != 3)` | 分割後の要素数が正確に3つ（R, G, B）でない場合はエラー。 |
