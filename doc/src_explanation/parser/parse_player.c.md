# `src/parser/parse_player.c` 詳細解説

## 概要
マップパース後にマップ配列を走査し、プレイヤーの開始位置（N, S, E, W）を特定します。プレイヤーが見つかった場合、その座標と初期の向き（方向ベクトルおよびカメラ平面ベクトル）を設定します。

## 依存関係
*   `parse.h`: パース用ヘッダ。
*   `libft.h`: `ft_strchr` 等。

## 関数詳細

### 1. `set_direction`
#### プロトタイプ
`void set_direction(t_game *game)`

#### 戻り値
なし

#### 解説
文字（'N', 'S', 'W', 'E'）に基づいて、方向ベクトル `dir` とカメラ平面ベクトル `plane` を設定します。
*   **N (北)**: `dir(0, -1)`, `plane(0.66, 0)`
*   **S (南)**: `dir(0, 1)`, `plane(-0.66, 0)`
*   ... (以下同様)
`plane` ベクトルの長さ（0.66）は視野角（FOV）を決定します（約66度）。

### 2. `set_player_info`
#### プロトタイプ
`static void set_player_info(t_game *game, int x, int y, char dir)`

#### 戻り値
なし

#### 解説
プレイヤーの初期座標 `(x, y)` をグリッドの中心 `(x + 0.5, y + 0.5)` に補正して保存し、`set_direction` を呼び出してベクトルの初期化を行います。

### 3. `find_player`
#### プロトタイプ
`int find_player(t_game *game)`

#### 戻り値
*   `1`: プレイヤーが「ただ1人」見つかった。
*   `0`: プレイヤーがいない、または複数人いる。

#### 解説
マップ全体を走査して `NSWE` の文字をカウントします。カウントがちょうど1の場合のみ成功とします。

### コード行別解説 (`find_player`)

| 行番号 | コード | 詳細解説 |
| :--- | :--- | :--- |
| 54-56 | `while (game->map.grid[y]) ...` | **マップ走査**<br>2重ループでマップの全セルを確認します。 |
| 57 | `if (ft_strchr("NSWE", ...))` | 現在のセルがプレイヤー文字か判定します。 |
| 59 | `set_player_info(...)` | プレイヤーが見つかったら情報をセットしますが、すぐに終了せずカウントを続けます（複数存在エラーを検知するため）。 |
| 65-66 | `if (count != 1) return (0);` | **人数チェック**<br>プレイヤーは必ず1人でなければなりません。0人でも2人以上でもエラーです。 |
