# マップ検証ルール

本文書では、`srcs/parse/` および `srcs/check/` の実装に基づいた、cub3Dプロジェクトにおける「正しいマップ（有効なマップ）」の条件を定義します。

## 1. ファイル名と拡張子
**参照元**: `srcs/check/check.c` - `check_filename`

*   **拡張子**: マップファイルは必ず `.cub` という拡張子で終わる必要があります。
*   **妥当性**: ファイル名が正しく `.cub` で終了しているかチェックされます（例: `map.cub` は有効、`map.cub.txt` は無効）。

## 2. 設定要素 (Configuration Elements)
**参照元**: `srcs/parse/parse.c` - `parse_elem`

マップ内容の記述の前に、以下の **6つの要素** がファイル内で定義されている必要があります。これらは順不同で記述可能ですが、全て揃っている必要があります。

### テクスチャ (4要素)
*   **識別子**: `NO` (北), `SO` (南), `WE` (西), `EA` (東)
*   **形式**: `識別子 path/to/texture.xpm`
*   **条件**:
    *   パスは有効な **.xpm** ファイルを指している必要があります。
    *   **重要**: プログラム実行時に、そのテクスチャファイルが**実際に存在し**、読み込み可能である必要があります。ファイルが見つからない場合、マップは無効とみなされます（実行時エラー）。

### 色設定 (2要素)
*   **識別子**: `F` (床), `C` (天井)
*   **形式**: `識別子 R,G,B`
*   **条件**:
    *   `R`, `G`, `B` は **0 から 255** の整数である必要があります。
    *   各数値はカンマで区切られている必要があります。

## 3. マップ構造 (Map Structure)
**参照元**: `srcs/parse/parse_map.c` & `srcs/parse/valid_map.c`

設定要素の後に、マップのレイアウト記述が続きます。

### 使用可能な文字 (`valid_map.c` - `is_valid_char`)
マップグリッド内では、以下の文字のみが許可されています：
*   `0`: 何もない空間 (移動可能)
*   `1`: 壁
*   `N`, `S`, `E`, `W`: プレイヤーの開始位置と向き
*   ` ` (スペース): マップ外の空白
*   `2`: スプライト (ボーナス機能)（`is_walkable` では移動可能として扱われます）
*   `D`: ドア (ボーナス機能)（`is_walkable` では移動可能として扱われます）

**注**: 上記以外の文字を使用すると、「Invalid map characters（無効なマップ文字）」エラーとなります。

### プレイヤーの要件 (`find_player`)
*   マップ全体で、プレイヤー（`N`, `S`, `W`, または `E`）が **ただ1人** だけ存在する必要があります。
*   プレイヤーが0人、または複数人いる場合はエラーとなります。

### 壁で閉じられていること (`valid_map.c` - `check_map_closed`)
マップは壁によって完全に囲まれている必要があります。「塗りつぶし（Flood Fill）」のようなロジックが暗黙的に適用されます：

*   **ロジック**:
    *   グリッド内の全てのセルを走査します。
    *   セルが **移動可能** (つまり `0`, `2`, `D`, またはプレイヤー) である場合、その隣接セル（上下左右）をチェックします。
*   **失敗条件（エラー条件）**:
    1.  移動可能なセルが **マップの端**（最上行、最下行、左端列、右端列）にある場合。
    2.  移動可能なセルが ` ` (スペース) 文字と隣接している場合。

**要約**: 全ての移動可能なエリアは、`1` (壁) によって閉じ込められていなければなりません。
